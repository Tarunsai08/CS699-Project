<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Organ Donation Mapper</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Organ Donation Mapper - A platform to connect organ donors with recipients">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <header class="site-header" role="banner">
    <div class="container">
      <a class="brand" href="{{ url_for('index') }}" aria-label="Organ Donation Mapper Home">
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Organ Donation Mapper logo" class="logo">
        <span>Organ Donation Mapper</span>
      </a>
      <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('search') }}">Search</a>
        {% if 'user' not in session %}
          <a href="{{ url_for('signup') }}">Sign up</a>
          <a href="{{ url_for('login') }}">Login</a>
          <a href="{{ url_for('hospital_login') }}">Hospital Portal</a>
        {% else %}
          {% if session.role == 'admin' %}
            <a href="{{ url_for('admin_dashboard') }}">Admin</a>
          {% elif session.role == 'hospital' %}
            <a href="{{ url_for('hospital_dashboard') }}">Hospital</a>
          {% else %}
          <a href="{{ url_for('request_organ') }}">Request Organ</a>
          <a href="{{ url_for('my_requests') }}">My Requests</a>
          {% endif %}
          <a href="{{ url_for('logout') }}">Logout ({{ session.user }})</a>
        {% endif %}
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
          <span class="theme-icon">ðŸŒ™</span>
        </button>
      </nav>
    </div>
  </header>

  <main id="main-content" class="container" role="main">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages" role="alert" aria-live="polite">
          {% for cat, msg in messages %}
            <div class="flash {{ cat }}" role="status">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <p>&copy; 2025 Organ Donation Mapper. All rights reserved.</p>
      <p class="footer-accessibility">
        <a href="#main-content">Back to top</a> | 
        <span>Accessible to WCAG 2.1 Level AA standards</span>
      </p>
    </div>
  </footer>

  <script>
    // Dark mode toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.querySelector('.theme-icon');
    const html = document.documentElement;
    
    // Check for saved theme preference or default to light mode
    const currentTheme = localStorage.getItem('theme') || 'light';
    html.setAttribute('data-theme', currentTheme);
    updateIcon(currentTheme);
    
    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateIcon(newTheme);
      
      // Announce theme change to screen readers
      const announcement = document.createElement('div');
      announcement.setAttribute('role', 'status');
      announcement.setAttribute('aria-live', 'polite');
      announcement.className = 'sr-only';
      announcement.textContent = `Theme changed to ${newTheme} mode`;
      document.body.appendChild(announcement);
      setTimeout(() => announcement.remove(), 1000);
    });
    
    function updateIcon(theme) {
      themeIcon.textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
      themeToggle.setAttribute('aria-label', theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode');
    }

    // Keyboard navigation improvements
    document.addEventListener('keydown', (e) => {
      // Allow Escape key to close modals or return focus
      if (e.key === 'Escape') {
        const activeElement = document.activeElement;
        if (activeElement && activeElement.blur) {
          activeElement.blur();
        }
      }
    });

    // Add focus visible class for keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        document.body.classList.add('user-is-tabbing');
      }
    });

    document.addEventListener('mousedown', () => {
      document.body.classList.remove('user-is-tabbing');
    });
  </script>
</body>
</html>